<div class="transactions-container">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" [routerLink]="['/dashboard']">
        <i class="bi bi-graph-up-arrow text-warning me-2"></i>EagleInvest
      </a>
      
      <div class="navbar-nav ms-auto d-flex flex-row align-items-center">
        <a class="nav-link" [routerLink]="['/dashboard']">
          <i class="bi bi-house me-1"></i>Home
        </a>
        <a class="nav-link ms-3" [routerLink]="['/dashboard']">
          <i class="bi bi-speedometer2 me-1"></i>Dashboard
        </a>
        <a class="nav-link ms-3" [routerLink]="['/withdrawals']">
          <i class="bi bi-cash-coin me-1"></i>Withdrawals
        </a>
        <a class="nav-link ms-3" [routerLink]="['/transactions']" routerLinkActive="active">
          <i class="bi bi-list-check me-1"></i>Transactions
        </a>
        <a class="nav-link ms-3" [routerLink]="['/profile']">
          <i class="bi bi-person me-1"></i>Profile
        </a>
        
        <button class="btn btn-warning btn-sm ms-3" (click)="logout()">
          <i class="bi bi-box-arrow-right me-1"></i>Log Out
        </button>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-content">
    <div class="container-fluid py-4">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col-12">
          <h1 class="display-6 fw-bold text-white mb-2">Historial de Transacciones</h1>
          <p class="text-light">Registro completo de todas tus transacciones e inversiones</p>
        </div>
      </div>

      <!-- Filter and Summary -->
      <div class="row mb-4">
        <div class="col-lg-8">
          <div class="card bg-dark border-secondary">
            <div class="card-body">
              <div class="row">
                <div class="col-md-3 text-center">
                  <h5 class="text-success fw-bold">{{(transactionsData()?.data?.length || 0)}}</h5>
                  <small class="text-muted">Total Transacciones</small>
                </div>
                <div class="col-md-3 text-center">
                  <h5 class="text-info fw-bold">{{getEarningsCount()}}</h5>
                  <small class="text-muted">Ganancias</small>
                </div>
                <div class="col-md-3 text-center">
                  <h5 class="text-warning fw-bold">{{getInvestmentsCount()}}</h5>
                  <small class="text-muted">Inversiones</small>
                </div>
                <div class="col-md-3 text-center">
                  <h5 class="text-primary fw-bold">${{getTotalEarnings() | number:'1.2-2'}}</h5>
                  <small class="text-muted">Total Ganancias</small>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="card bg-dark border-secondary">
            <div class="card-body">
              <div class="row">
                <div class="col-6">
                  <button class="btn btn-outline-info btn-sm w-100">
                    <i class="bi bi-funnel me-1"></i>Filtrar
                  </button>
                </div>
                <div class="col-6">
                  <button class="btn btn-outline-success btn-sm w-100">
                    <i class="bi bi-download me-1"></i>Exportar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Transactions Table -->
      <div class="row">
        <div class="col-12">
          <div class="card bg-dark border-secondary">
            <div class="card-header bg-transparent border-secondary">
              <h5 class="text-white mb-0">Todas las Transacciones</h5>
            </div>
            <div class="card-body">
              @if (transactionsData()?.data && transactionsData()!.data.length > 0) {
                <div class="table-responsive">
                  <table class="table table-dark table-hover">
                    <thead>
                      <tr class="border-secondary">
                        <th class="text-light">Fecha</th>
                        <th class="text-light">Tipo</th>
                        <th class="text-light">Descripción</th>
                        <th class="text-light">Monto</th>
                        <th class="text-light">Estado</th>
                        <th class="text-light">Referencia</th>
                      </tr>
                    </thead>
                    <tbody>
                      @for (transaction of transactionsData()!.data; track transaction.id) {
                        <tr>
                          <td class="text-muted">{{transaction.created_at | date:'short'}}</td>
                          <td>
                            <span class="badge" 
                                  [class]="transaction.type === 'earnings' ? 'bg-success' : 
                                          transaction.type === 'investment' ? 'bg-info' : 
                                          transaction.type === 'withdrawal' ? 'bg-warning' : 'bg-secondary'">
                              <i class="bi me-1" 
                                 [class]="transaction.type === 'earnings' ? 'bi-graph-up' : 
                                         transaction.type === 'investment' ? 'bi-plus-circle' : 
                                         transaction.type === 'withdrawal' ? 'bi-dash-circle' : 'bi-arrow-left-right'"></i>
                              {{transaction.type | titlecase}}
                            </span>
                          </td>
                          <td>
                            <div>
                              <strong class="text-white">{{transaction.description}}</strong>
                              <br>
                              <small class="text-muted">{{transaction.reference_id || 'Sistema'}}</small>
                            </div>
                          </td>
                          <td class="text-white fw-bold">${{transaction.amount | number:'1.2-2'}}</td>
                          <td>
                            <span class="badge" 
                                  [class]="transaction.status === 'completed' ? 'bg-success' : 
                                          transaction.status === 'pending' ? 'bg-warning' : 'bg-danger'">
                              {{transaction.status | titlecase}}
                            </span>
                          </td>
                          <td class="text-muted small">
                            {{transaction.reference_id || '#' + transaction.id}}
                          </td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>

                <!-- Pagination -->
                @if (transactionsData()?.total && transactionsData()!.total > transactionsData()!.per_page) {
                  <nav aria-label="Transaction pagination" class="mt-4">
                    <ul class="pagination pagination-sm justify-content-center">
                      <li class="page-item" [class.disabled]="transactionsData()?.current_page === 1">
                        <a class="page-link bg-dark border-secondary text-muted" href="#" tabindex="-1">Anterior</a>
                      </li>
                      @for (page of [].constructor(transactionsData()?.last_page || 1); track $index) {
                        <li class="page-item" [class.active]="transactionsData()?.current_page === ($index + 1)">
                          <a class="page-link" 
                             [class]="transactionsData()?.current_page === ($index + 1) ? 'bg-info border-info' : 'bg-dark border-secondary text-white'" 
                             href="#">{{$index + 1}}</a>
                        </li>
                      }
                      <li class="page-item" [class.disabled]="transactionsData()?.current_page === transactionsData()?.last_page">
                        <a class="page-link bg-dark border-secondary text-white" href="#">Siguiente</a>
                      </li>
                    </ul>
                  </nav>
                }
              } @else {
                <div class="text-center py-5">
                  <i class="bi bi-list-check text-muted" style="font-size: 3rem;"></i>
                  <h5 class="text-white mt-3">No hay transacciones disponibles</h5>
                  <p class="text-muted">Las transacciones aparecerán aquí cuando realices operaciones</p>
                </div>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>